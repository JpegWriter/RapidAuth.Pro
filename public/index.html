<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JpegtoVideo - Email Verification Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .tab-active {
            background: #000;
            color: white;
        }
        .tab-inactive {
            background: #f5f5f5;
            color: #666;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-4xl flex rounded-3xl overflow-hidden shadow-2xl">
        <!-- Left Side - Branding -->
        <div class="w-1/2 bg-gradient-to-br from-cyan-200 to-blue-300 p-12 flex flex-col justify-center relative overflow-hidden">
            <div class="relative z-10">
                <h1 class="text-4xl font-bold text-gray-800 mb-4">JpegtoVideo</h1>
                <p class="text-xl text-gray-700 leading-relaxed">
                    Work with ease,<br>
                    live more.
                </p>
            </div>
            <!-- Decorative waves -->
            <div class="absolute bottom-0 left-0 w-full">
                <svg viewBox="0 0 400 200" class="w-full h-32 opacity-30">
                    <path d="M0,100 C100,50 200,150 400,100 L400,200 L0,200 Z" fill="rgba(255,255,255,0.3)"/>
                    <path d="M0,120 C150,70 250,170 400,120 L400,200 L0,200 Z" fill="rgba(255,255,255,0.2)"/>
                </svg>
            </div>
        </div>

        <!-- Right Side - Login Form -->
        <div class="w-1/2 bg-white p-12 flex flex-col justify-center">
            <!-- Login Method Tabs -->
            <div class="flex mb-8 bg-gray-100 rounded-lg p-1">
                <button class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all tab-inactive" onclick="switchTab('qr')">
                    <span class="mr-2">üì±</span> QR
                </button>
                <button class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all tab-inactive" onclick="switchTab('qq')">
                    <span class="mr-2">üí¨</span> QQ
                </button>
                <button class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all tab-active" onclick="switchTab('email')" id="email-tab">
                    <span class="mr-2">‚úâÔ∏è</span> Email
                </button>
            </div>

            <!-- Email Login Form -->
            <div id="email-form">
                <h2 class="text-2xl font-semibold text-gray-800 mb-8 text-center">Email Verification Login</h2>
                
                <!-- Step 1: Email Input -->
                <div id="email-step" class="space-y-6">
                    <div>
                        <input 
                            type="email" 
                            id="email-input"
                            class="w-full px-4 py-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-gray-600"
                            placeholder="Please enter your email address"
                            required
                        >
                    </div>
                    
                    <div class="flex gap-3">
                        <input 
                            type="text" 
                            id="code-input"
                            class="flex-1 px-4 py-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-gray-600"
                            placeholder="Please enter the code"
                            maxlength="6"
                            disabled
                        >
                        <button 
                            onclick="getCode()" 
                            id="get-code-btn"
                            class="px-6 py-4 bg-gray-100 text-gray-400 rounded-lg font-medium transition-all cursor-not-allowed"
                            disabled
                        >
                            Get code
                        </button>
                    </div>

                    <button 
                        onclick="login()" 
                        id="login-btn"
                        class="w-full bg-black text-white py-4 rounded-lg font-semibold hover:bg-gray-800 transition-all disabled:bg-gray-300 disabled:cursor-not-allowed"
                        disabled
                    >
                        Login
                    </button>

                    <p class="text-center text-gray-500 text-sm">
                        No password is required
                    </p>
                </div>

                <!-- Success State -->
                <div id="success-step" class="hidden text-center space-y-6">
                    <div class="text-6xl mb-4">üéâ</div>
                    <h3 class="text-2xl font-semibold text-green-600 mb-4">
                        Login Successful!
                    </h3>
                    <p class="text-gray-600 mb-6">
                        Welcome! You have been successfully authenticated.
                    </p>
                    <button 
                        onclick="resetForm()" 
                        class="bg-blue-600 text-white py-2 px-6 rounded-lg hover:bg-blue-700 transition-all"
                    >
                        Try Again
                    </button>
                </div>

                <!-- Loading State -->
                <div id="loading" class="hidden text-center py-8">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                    <p class="text-gray-600">Processing...</p>
                </div>

                <!-- Error Message -->
                <div id="error-message" class="hidden mt-4 p-4 bg-red-50 border border-red-200 rounded-lg">
                    <p class="text-red-700 text-sm text-center"></p>
                </div>
            </div>

            <!-- Placeholder for other tabs -->
            <div id="qr-form" class="hidden text-center py-12">
                <div class="text-6xl mb-4">üì±</div>
                <h3 class="text-xl font-semibold text-gray-800 mb-4">QR Code Login</h3>
                <p class="text-gray-600">QR code login functionality would be implemented here.</p>
            </div>

            <div id="qq-form" class="hidden text-center py-12">
                <div class="text-6xl mb-4">üí¨</div>
                <h3 class="text-xl font-semibold text-gray-800 mb-4">QQ Login</h3>
                <p class="text-gray-600">QQ login functionality would be implemented here.</p>
            </div>
        </div>
    </div>

    <script>
        let currentEmail = '';
        let codeRequested = false;

        function switchTab(tab) {
            // Update tab styles
            document.querySelectorAll('.flex-1').forEach(btn => {
                btn.className = btn.className.replace('tab-active', 'tab-inactive');
            });
            
            if (tab === 'email') {
                document.getElementById('email-tab').className = document.getElementById('email-tab').className.replace('tab-inactive', 'tab-active');
            }

            // Show/hide forms
            document.getElementById('email-form').classList.toggle('hidden', tab !== 'email');
            document.getElementById('qr-form').classList.toggle('hidden', tab !== 'qr');
            document.getElementById('qq-form').classList.toggle('hidden', tab !== 'qq');
        }

        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function updateUI() {
            const email = document.getElementById('email-input').value;
            const code = document.getElementById('code-input').value;
            const getCodeBtn = document.getElementById('get-code-btn');
            const loginBtn = document.getElementById('login-btn');
            const codeInput = document.getElementById('code-input');

            const emailValid = validateEmail(email);
            
            // Enable/disable Get code button
            if (emailValid && !codeRequested) {
                getCodeBtn.disabled = false;
                getCodeBtn.className = 'px-6 py-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-all cursor-pointer';
                getCodeBtn.textContent = 'Get code';
            } else if (codeRequested) {
                getCodeBtn.disabled = true;
                getCodeBtn.className = 'px-6 py-4 bg-gray-300 text-gray-500 rounded-lg font-medium transition-all cursor-not-allowed';
                getCodeBtn.textContent = 'Code sent';
            } else {
                getCodeBtn.disabled = true;
                getCodeBtn.className = 'px-6 py-4 bg-gray-100 text-gray-400 rounded-lg font-medium transition-all cursor-not-allowed';
                getCodeBtn.textContent = 'Get code';
            }

            // Enable/disable code input
            codeInput.disabled = !codeRequested;
            if (codeRequested) {
                codeInput.className = codeInput.className.replace('text-gray-400', 'text-gray-600');
            }

            // Enable/disable login button
            if (emailValid && code.length === 6 && codeRequested) {
                loginBtn.disabled = false;
                loginBtn.className = 'w-full bg-black text-white py-4 rounded-lg font-semibold hover:bg-gray-800 transition-all';
            } else {
                loginBtn.disabled = true;
                loginBtn.className = 'w-full bg-gray-300 text-gray-500 py-4 rounded-lg font-semibold transition-all cursor-not-allowed';
            }
        }

        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('email-step').classList.add('hidden');
            document.getElementById('success-step').classList.add('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.querySelector('p').textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }

        async function getCode() {
            const email = document.getElementById('email-input').value;
            if (!validateEmail(email)) {
                showError('Please enter a valid email address');
                return;
            }

            currentEmail = email;
            showLoading();

            try {
                const response = await fetch('/auth/request-code', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email })
                });

                const data = await response.json();
                hideLoading();

                if (response.ok) {
                    codeRequested = true;
                    document.getElementById('email-step').classList.remove('hidden');
                    document.getElementById('code-input').focus();
                    updateUI();
                } else {
                    showError(data.error || 'Failed to send code');
                    document.getElementById('email-step').classList.remove('hidden');
                }
            } catch (error) {
                hideLoading();
                showError('Network error. Please try again.');
                document.getElementById('email-step').classList.remove('hidden');
            }
        }

        async function login() {
            const code = document.getElementById('code-input').value;
            if (!code || code.length !== 6) {
                showError('Please enter the 6-digit verification code');
                return;
            }

            showLoading();

            try {
                const response = await fetch('/auth/verify-code', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        email: currentEmail, 
                        code 
                    })
                });

                const data = await response.json();
                hideLoading();

                if (response.ok) {
                    localStorage.setItem('authToken', data.token);
                    document.getElementById('email-step').classList.add('hidden');
                    document.getElementById('success-step').classList.remove('hidden');
                } else {
                    showError(data.error || 'Invalid verification code');
                    document.getElementById('email-step').classList.remove('hidden');
                }
            } catch (error) {
                hideLoading();
                showError('Network error. Please try again.');
                document.getElementById('email-step').classList.remove('hidden');
            }
        }

        function resetForm() {
            document.getElementById('email-input').value = '';
            document.getElementById('code-input').value = '';
            currentEmail = '';
            codeRequested = false;
            
            document.getElementById('email-step').classList.remove('hidden');
            document.getElementById('success-step').classList.add('hidden');
            document.getElementById('error-message').classList.add('hidden');
            
            updateUI();
        }

        // Event listeners
        document.getElementById('email-input').addEventListener('input', updateUI);
        document.getElementById('code-input').addEventListener('input', updateUI);

        // Enter key handlers
        document.getElementById('email-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !document.getElementById('get-code-btn').disabled) {
                getCode();
            }
        });

        document.getElementById('code-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !document.getElementById('login-btn').disabled) {
                login();
            }
        });

        // Auto-submit when 6 digits are entered
        document.getElementById('code-input').addEventListener('input', (e) => {
            if (e.target.value.length === 6 && !document.getElementById('login-btn').disabled) {
                setTimeout(login, 500);
            }
        });

        // Initialize UI
        updateUI();
    </script>
</body>
</html>